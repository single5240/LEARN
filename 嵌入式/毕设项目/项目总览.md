#### 资源链接

1. [NevermindZZT/letter-shell: letter shell](https://github.com/NevermindZZT/letter-shell?tab=readme-ov-file#%E7%A7%BB%E6%A4%8D%E8%AF%B4%E6%98%8E) --- letter shell组件
    
2. [rxi/log.c: A simple logging library implemented in C99](https://github.com/rxi/log.c) --- 日志功能模块
    
3. [J-Link RTT – Real Time Transfer](https://www.segger.com/products/debug-probes/j-link/technology/about-real-time-transfer/) --- J-Link实时传输
    
4. [SEGGER - The Embedded Experts - Downloads - SystemView](https://www.segger.com/downloads/systemview/) --- 嵌入式操作系统观测软件
    
5. [EasyFlash: Lightweight IoT device information storage solution: KV/IAP/LOG. | 轻量级物联网设备信息存储方案](https://github.com/armink/EasyFlash) --- easyFlash
    
#### 结构

##### 开发环境

1. stm32cubemx + keil v5 生成和烧录代码
    
2. Vs code 编写代码
    
##### 开发组件

1. SEGGER’s Real Time Transfer（RTT）
    
    1. 一种基于SEGGER公司的基于JLink调试器的交互式用户I/O的技术。故名思义，就是一种基于jlink的和用户进行交互的技术，可以直观的显示调试芯片的信息，以及可以让用户和调试芯片进行互动的技术。
        
    2. 主要功能
        
        1. 与目标嵌入式应用的双向通信能力
            
        2. 不影响嵌入式应用的实时行为的高速传输速率
            
        3. 使用调试通道用作通信（相当于不用再额外占用GPIO等外设接口）
            
        4. 不需要在目标嵌入式系统增加额外的硬件或引脚
            
2. Letter shell组件
    
    1. [letter shell](https://github.com/NevermindZZT/letter-shell)是一个C语言编写的，可以嵌入在程序中的嵌入式shell，主要面向嵌入式设备，以C语言函数为运行单位，可以通过命令行调用，运行程序中的函数
        
    2. 主要功能
        
        1. 命令自动补全
            
        2. 快捷键功能定义
            
        3. 变量支持
            
        4. 代理函数和参数代理解析
            
3. log日志功能模块
    
    1. 一个简单的log系统，自动高效地管理系统log，用户可自定义添加和分级管理log，并支持log输出重定向
        
    2. 主要功能
        
        1. log分级管理 --- 输出、屏蔽某些等级等
            
        2. 输出重定向
            
        3. 格式化输出
            
4. SystemView嵌入式操作系统观测
    
    1. Segger官方出品的嵌入式操作系统观测软件，仅需使用JLink与嵌入式设备连接，在目标设备上添加下位机代码即可监视包括但不限于FreeRTOS等操作系统，同时也支持裸机程序。
        
    2. 主要功能
        
        1. 观测系统运行事件
            
        2. 监测任务时间线
            
        3. 分析和记录任务详细信息统计(阻塞，运行时间，CPU占用率，栈使用信息)
            
5. easyFlash轻量级物联网设备信息存储方案
    
    1. 一款开源的轻量级嵌入式Flash存储器库，方便开发者更加轻松的实现基于Flash存储器的常见应用开发。非常适合智能家居、可穿戴、工控、医疗、物联网等需要断电存储功能的产品，资源占用极低，支持各种 MCU 片上存储器
        
    2. 主要功能
        
        1. ENV 快速保存产品参数
            
        2. IAP 在线升级
            

##### 驱动算法

1. 串行PID控制及FOC算法
    
    1. 三环控制框架
        
        ![](https://qw633jfnij8.feishu.cn/space/api/box/stream/download/asynccode/?code=MzhhMjY0ZWQ2MjllYTdhN2M4MGNiZDUxN2E5YTg0MzNfR3l5NTZydjhIbkNVRVZ2eUQ4ZTJmREw5SzJ6ZW1GZEFfVG9rZW46QndlVmJVVnBpbzdGM054TFl3SWNzYWxTbk5jXzE3MTI1NjIxNTM6MTcxMjU2NTc1M19WNA)
        
    2. FOC算法 --- ST官方电机库上做修改
        
        ![](https://qw633jfnij8.feishu.cn/space/api/box/stream/download/asynccode/?code=YWM2MDg5MWIwMjg3MTYyZTViZWI3ZWQyNjBkZjlmNzZfMVM2UzlwMko1N0hZRUlyVUhIQXM0MFB4aGlQNDVTa1dfVG9rZW46UUpsRGJxcks1b2RCRG54TTA2UWNTdUtmblhmXzE3MTI1NjIxNTM6MTcxMjU2NTc1M19WNA)
        
          
        
2. S形启动及停止
    

![](https://qw633jfnij8.feishu.cn/space/api/box/stream/download/asynccode/?code=MjAwOTBkMmQ3ZjlmMWE0M2QxM2UwZDE2Zjg3OTQ4Y2VfTDlnc3drSENBdUpVRlJTWThNYXFlTHVQN3JGSXdWTm5fVG9rZW46Q2lmYmJmZVlGb1cwQ2R4UkZxUmNMRlc3bmxkXzE3MTI1NjIxNTM6MTcxMjU2NTc1M19WNA)

![](https://qw633jfnij8.feishu.cn/space/api/box/stream/download/asynccode/?code=MTk3YzU4NWI5ZDFjYTA2Yzk4Mjg3YTNlNmI3NGNjNzhfQ01jMjFiSlFRR1NqTXZEd3ZCY1IwQUlmamdYUjI2TExfVG9rZW46QU1LcGI1djRLb08zNVN4VUxxUmNoSHFqbnpnXzE3MTI1NjIxNTM6MTcxMjU2NTc1M19WNA)

  

##### 上位机

暂时无法在飞书文档外展示此内容

##### mcu和上位机通讯协议

###### 帧头 [0]

1. 0x04 --- mcu发给上位机的参数
    
2. 0x08 --- 上位机发给mcu的参数
    
3. 0x40 --- 上位机发给mcu的命令
    

###### 数据帧

1. 0x04 类型
    
    1. [1] --- 电机序号 0-4
        
    2. [2-4] --- 电机参数类型
        
        1. 0x00 --- 位置（角度）
            
        2. 0x01 --- 速度
            
        3. 0x02 --- 电流
            
        4. 0x03 --- 力矩
            
        5. 其他保留
            
    3. [3-4] --- 参数value
        
    4. [5] --- uint8_t CRC校验
        
2. 0x08 类型 --- 0x40
    
3. 0x40 类型
    
    1. [1] --- 电机序号 0-4
        
    2. [2] --- 电机状态控制