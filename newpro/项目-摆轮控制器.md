---
tags:
  - 项目档案
修订日期: 2024-12-26T11:23:00
---

# 使用场景

用于摆轮的控制。
目前的摆轮主要是脉冲步进控制。带一个回原光电。 需要3路脉冲。

# 需求

- 三路以上的脉冲/方向输出控制，最高频率100kHz以上
- 支持限位信号输入
- 支持回原指令
- 支持电子机械减速比的设置
- 支持加减速控制（梯形或者7段加减速）


# 调研

[Marlin固件的步进电机控制代码解析_51CTO博客_marlin步进电机设置](https://blog.51cto.com/raevo/1758415)

单脉冲+重复计数模式  [基于STM32F4单片机对步进电机的控制（有代码）「建议收藏」-腾讯云开发者社区-腾讯云 (tencent.com)](https://cloud.tencent.com/developer/article/2079714)

# 方案


| 对象     | 选型                                |               |
| ------ | --------------------------------- | ------------- |
| 主控     | GD32F103RGT6                      |               |
| 脉冲输出   | TLP2745 高速光耦 4路                   | 设计为源型输出       |
| 方向输出   | EL3H7 + P-MOS 4路                  | 设计为源型输出       |
| 限位输入   | EL3H7, 8路                         | 设计为源型输入       |
| 电源     | ME3116AM6G  24V 转 5V  AMS1117-3.3 |               |
| 通讯     | RS485                             | Modbus-RTU 协议 |
| EEPROM | AT24C02                           |               |

注意事项
> GD32F103RG有8个以上的定时器， RC似乎没有



### IO分配
- pulse  定时器输出（级联）
- 输入  支持中断

| 信号                | 引脚      | 涉及硬件   |
| ----------------- | ------- | ------ |
| Pulse1            |         |        |
| Pulse2            |         |        |
| Pulse3            |         |        |
| Pulse4            |         |        |
| dir1              |         |        |
| dir2              |         |        |
| dir3              |         |        |
| dir4              |         |        |
| input1            |         |        |
| input2            |         |        |
| input3            |         |        |
| input4            |         |        |
| input5            |         |        |
| input6            |         |        |
| input7            |         |        |
| input8            |         |        |
| 系统指示灯 red         |         |        |
| 系统指示灯 green       |         |        |
| RS485 UART TX     |         |        |
| RS485 UART RX     |         |        |
| RS233/TTL UART TX | PA      |        |
| RS233/TTL UART RX |         |        |
| SWDIO             | PA13,14 |        |
| 拨码开关的 IO          |         |        |
| IIC               |         | EEPROM |

#### 接口

pulse 与 dir 和 input 合计 16pin。 使用 之前购买的 欧路电子的 9x2pin的端子， 剩余的2pin用于 P24与N24

RS485端子考虑使用与滚筒驱动器一样的 MX3.0 2x3P 端子； 或者使用和电源输入一样的科发 3.5x3P的端子

电源使用与 欧路电子的端子相似的 2x3P端子。

TTL UART 与 SWDIO考虑使用一个 2x4P的端子。该接口主要用于调试，配置，或升级

LED
## 硬件设计